#################### 全局配置 ####################

# HTTP 代理端口
port: 7890

# SOCKS5 代理端口
socks-port: 7891

# Linux 和 macOS 的 redir 代理端口
redir-port: 7892

# TProxy 代理端口 (仅适用于 Linux, 需要内核支持)
tproxy-port: 7893

# 允许局域网的连接
allow-lan: true

# 规则模式：Rule（规则） / Global（全局代理）/ Direct（全局直连）
mode: rule

# 是否开启 UDP 转发
udp: true

# ipv6开关
ipv6: true

# 设置日志输出级别 (默认级别：silent，即不输出任何内容，以避免因日志内容过大而导致程序内存溢出）。
# 5 个级别：silent / info / warning / error / debug。级别越高日志输出量越大，越倾向于调试，若需要请自行开启。
log-level: debug
# Clash 的 RESTful API
external-controller: '0.0.0.0:9090'
experimental:
  ignore-resolve-fail: true

bind-address: '*'
# RESTful API 的口令
secret: ''

# 您可以将静态网页资源（如 clash-dashboard）放置在一个目录中，clash 将会服务于 `RESTful API/ui`
# 参数应填写配置目录的相对路径或绝对路径。
external-ui: /clash-dashboard/

# interface-name: eth0

# tun 配置
tun:
  enable: true
  stack: system
  dns-hijack:
    - 8.8.8.8:53
    - tcp://8.8.8.8:53
    - any:53
    - tcp://any:53
  auto-route: true
  auto-redir: true
  auto-detect-interface: true

# geo配置
geodata-mode: true
geo-auto-update: true
geo-update-interval: 24
geox-url:
  geoip: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"
  asn: "https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"

#################### DNS ####################
dns:
  enable: true # 关闭将使用系统 DNS
  listen: 0.0.0.0:53
  ipv6: true # 当为 false 时, AAAA 查询的响应将为空
  enhanced-mode: fake-ip
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  fake-ip-range: 198.18.0.1/16
  use-hosts: true
  nameserver-policy:
    'geosite:cn,private':
      - "https://223.5.5.5/dns-query"
      - "https://120.53.53.53/dns-query"
  nameserver:
    - https://doh.pub/dns-query # 默认值
    - https://dns.alidns.com/dns-query
    - https://1.1.1.1/dns-query
  fallback:
    - 'https://dns.cloudflare.com/dns-query'
    - 'https://dns.twnic.tw/dns-query'
    - 'tls://8.8.4.4:853'
    - 'tls://1.1.1.1'
  #如需过代理查询，应配置 proxy-server-nameserver, 以防出现鸡蛋问题
  proxy-server-nameserver:
    - https://doh.pub/dns-query
  #加载外网卡顿和慢的，去掉fallback组可改善
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
    - 0.0.0.0/8
    - 10.0.0.0/8
    - 100.64.0.0/10
    - 127.0.0.0/8
    - 169.254.0.0/16
    - 172.16.0.0/12
    - 192.0.0.0/24
    - 192.0.2.0/24
    - 192.88.99.0/24
    - 192.168.0.0/16
    - 198.18.0.0/15
    - 198.51.100.0/24
    - 203.0.113.0/24
    - 224.0.0.0/4
    - 240.0.0.0/4
    - 255.255.255.255/32
    domain:
    - "+.google.com"
    - "+.facebook.com"
    - "+.youtube.com"
    - "+.githubusercontent.com"
    - "+.googlevideo.com"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "+.linkedin.com"
  fake-ip-filter:
    - "*.lan"
    - "*.localdomain"
    - "*.example"
    - "*.invalid"
    - "*.localhost"
    - "*.test"
    - "*.local"
    - "*.home.arpa"
    - 'connect.rom.miui.com'
    - time.*.com
    - time.*.gov
    - time.*.edu.cn
    - time.*.apple.com
    - time-ios.apple.com
    - time1.*.com
    - time2.*.com
    - time3.*.com
    - time4.*.com
    - time5.*.com
    - time6.*.com
    - time7.*.com
    - ntp.*.com
    - ntp1.*.com
    - ntp2.*.com
    - ntp3.*.com
    - ntp4.*.com
    - ntp5.*.com
    - ntp6.*.com
    - ntp7.*.com
    - "*.time.edu.cn"
    - "*.ntp.org.cn"
    - "+.pool.ntp.org"
    - time1.cloud.tencent.com
    - music.163.com
    - "*.music.163.com"
    - "*.126.net"
    - musicapi.taihe.com
    - music.taihe.com
    - songsearch.kugou.com
    - trackercdn.kugou.com
    - "*.kuwo.cn"
    - api-jooxtt.sanook.com
    - api.joox.com
    - joox.com
    - y.qq.com
    - "*.y.qq.com"
    - streamoc.music.tc.qq.com
    - mobileoc.music.tc.qq.com
    - isure.stream.qqmusic.qq.com
    - dl.stream.qqmusic.qq.com
    - aqqmusic.tc.qq.com
    - amobile.music.tc.qq.com
    - "*.xiami.com"
    - "*.music.migu.cn"
    - music.migu.cn
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - localhost.ptlogin2.qq.com
    - localhost.sec.qq.com
    - "+.qq.com"
    - "+.tencent.com"
    - "+.srv.nintendo.net"
    - "*.n.n.srv.nintendo.net"
    - "+.stun.playstation.net"
    - xbox.*.*.microsoft.com
    - "*.*.xboxlive.com"
    - xbox.*.microsoft.com
    - xnotify.xboxlive.com
    - "+.battlenet.com.cn"
    - "+.wotgame.cn"
    - "+.wggames.cn"
    - "+.wowsgame.cn"
    - "+.wargaming.net"
    - proxy.golang.org
    - stun.*.*
    - stun.*.*.*
    - "+.stun.*.*"
    - "+.stun.*.*.*"
    - "+.stun.*.*.*.*"
    - "+.stun.*.*.*.*.*"
    - heartbeat.belkin.com
    - "*.linksys.com"
    - "*.linksyssmartwifi.com"
    - "*.router.asus.com"
    - mesu.apple.com
    - swscan.apple.com
    - swquery.apple.com
    - swdownload.apple.com
    - swcdn.apple.com
    - swdist.apple.com
    - lens.l.google.com
    - stun.l.google.com
    - "+.nflxvideo.net"
    - "*.square-enix.com"
    - "*.finalfantasyxiv.com"
    - "*.ffxiv.com"
    - "*.ff14.sdo.com"
    - ff.dorado.sdo.com
    - "*.mcdn.bilivideo.cn"
    - "+.media.dssott.com"
    - shark007.net
    - Mijia Cloud
    - "+.cmbchina.com"
    - "+.cmbimg.com"
    - local.adguard.org
    - "+.sandai.net"
    - "+.n0808.com"
    - services.googleapis.cn

global-client-fingerprint: chrome # 全局客户端指纹
global-ua: "Mozilla/5.0; AppleWebKit/537.36; Chrome/91.0.4472.114; Safari/537.36; Shadowrocket/1.9.7; meta/1.0.0; Sing/1.1.0" # 全局 UA ,默认clash.meta

#################### 缓存 ####################
profile:
  store-selected: true # 储存 API 对策略组的选择,以供下次启动时使用
  store-fake-ip: true # fake-ip 缓存,域名再次发生连接时,使用原有映射地址

# 网络嗅探
sniffer:
  enable: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    QUIC:
      ports: [443, 8443]
  force-domain:
    - "+.netflix.com"
    - "+.nflxvideo.net"
    - "+.amazonaws.com"
    - "+.media.dssott.com"
  skip-domain:
    - "+.apple.com"
    - Mijia Cloud
    - dlg.io.mi.com
    - "+.jd.com"
    - "+.taobao.com"
    - "+.tmall.com"
    - "*.rc.sunlogin.net"

##勿动，引用
p: &p
  type: http
  interval: 86400
  proxy: DIRECT
  size-limit: 0
  header:
    User-Agent:
     - "mihomo"
  health-check:
    enable: true
    url: https://www.gstatic.com/generate_204
    interval: 300
    timeout: 5000
  override:
    udp: true
    skip-cert-verify: true
  exclude-filter: "最新网址|剩余流量|过期时间"
u: &u
  use:
  - speed-cat

proxy-providers:
  speed-cat:
    <<: *p
    # 修改url为你的订阅地址
    url: ""
    path: ./proxy_providers/provider1.yaml

proxy-groups:
  - {name: 🎯 总模式, type: select, proxies: [🚀 节点选择,🌸 自动切换,🌎 全球直连]}
  - {name: 🚀 节点选择, type: select, <<: *u}
  - {name: 🌸 自动切换, <<: *u, tolerance: 10, type: url-test}
  - {name: Ⓜ️ 微软服务, type: select, proxies: [🌎 全球直连, 🎯 总模式,🌸 自动切换]}
  - {name: 🤖 ChatGPT, type: select, use: [speed-cat], filter: "台湾|日本|新加坡|美国"}
  - {name: 📢 谷歌FCM, type: select, proxies: [🌎 全球直连,🎯 总模式,🌸 自动切换]}
  - {name: 🎮 游戏平台, type: select, proxies: [🌎 全球直连,🎯 总模式,🌸 自动切换]}
  - {name: 🎬 油管视频, type: select, proxies: [🎯 总模式,🌸 自动切换,🌎 全球直连]}
  - {name: 📲 电报信息, type: select, proxies: [🎯 总模式,🌸 自动切换,🌎 全球直连]}
  - {name: 📢 谷歌服务, type: select, proxies: [🎯 总模式,🌸 自动切换,🌎 全球直连]}
  - {name: 🍎 苹果服务, type: select, proxies: [🌎 全球直连, 🎯 总模式,🌸 自动切换]}
  - {name: 🇭🇰 香港节点, type: url-test, use: [speed-cat], filter: "香港"}
  - {name: 🇹🇼 台湾节点, type: url-test, use: [speed-cat], filter: "台湾"}
  - {name: 🇯🇵 日本节点, type: url-test, use: [speed-cat], filter: "日本"}
  - {name: 🇸🇬 新加坡节点, type: url-test, use: [speed-cat], filter: "新加坡"}
  - {name: 🇺🇸 美国节点, type: url-test, use: [speed-cat], filter: "美国"}
  - {name: 其他节点, type: url-test, use: [speed-cat], exclude-filter: "香港|台湾|日本|新加坡|美国"}
  - {name: 🐋 漏网之鱼, type: select, proxies: [🎯 总模式,🌎 全球直连]}
  - {name: 🌎 全球直连, type: select, proxies: [DIRECT]}
  - {name: 🛑 广告拦截, type: select, proxies: [REJECT]}

##勿动，引用，规则的重复内容，<<: *r
r: &r
  type: http
  behavior: classical
  format: yaml
  interval: 86400
rule-providers:
  GoogleFCM:
    <<: *r
    path: ./rule/GoogleFCM.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GoogleFCM/GoogleFCM.yaml"
  ChinaCompanyIp:
    <<: *r
    format: text
    path: ./rule/ChinaCompanyIp.yaml
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaCompanyIp.list"
  ProxyGFWlist:
    <<: *r
    format: text
    path: ./rule/ProxyGFWlist.yaml
    url: "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyGFWlist.list"
  Openai:
    <<: *r
    path: ./rule/Openai.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml"
  Copilot:
    <<: *r
    path: ./rule/Copilot.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Copilot/Copilot.yaml"
  Claude:
    <<: *r
    path: ./rule/Claude.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Claude/Claude.yaml"
  Gemini:
    <<: *r
    path: ./rule/Gemini.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Gemini/Gemini.yaml"
  ChinaMedia:
    <<: *r
    path: ./rule/ChinaMedia.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaMedia/ChinaMedia.yaml"
  Epic:
    <<: *r
    path: ./rule/Epic.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Epic/Epic.yaml"
  Steam:
    <<: *r
    path: ./rule/Steam.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Steam/Steam.yaml"
  SteamCN:
    <<: *r
    path: ./rule/SteamCN.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/SteamCN/SteamCN.yaml"
  GameDownloadCN:
    <<: *r
    path: ./rule/GameDownloadCN.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Game/GameDownloadCN/GameDownloadCN.yaml"
  Telegram:
    <<: *r
    path: ./rule/Telegram.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.yaml"
  Youtube:
    <<: *r
    path: ./rule/Youtube.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml"
  Google:
    <<: *r
    path: ./rule/Google.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml"
  Microsoft:
    <<: *r
    path: ./rule/Microsoft.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft.yaml"
  Apple:
    <<: *r
    path: ./rule/Apple.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Apple/Apple.yaml"
  Advertising:
    <<: *r
    path: ./rule/Advertising.yaml
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Advertising/Advertising_Classical.yaml"

rules:
  # 自定义规则写在这里
  - DOMAIN-SUFFIX,z-lib.id,🎯 总模式
  - DOMAIN-KEYWORD,z-lib,🎯 总模式
  - DOMAIN-SUFFIX,download.epicgames.com,🌎 全球直连
  - RULE-SET,GameDownloadCN,🌎 全球直连
  - AND,(AND,(DST-PORT,443),(NETWORK,UDP)),(NOT,((GEOSITE,cn))),REJECT-DROP # 禁用quic(不包括国内)
  - AND,((PROCESS-NAME,clash),(NOT,((IN-TYPE,inner)))),REJECT
  - IP-CIDR,198.18.0.1/16,REJECT,no-resolve
  - IP-CIDR,198.168.3.1/24,DIRECT
  - GEOSITE,category-ads-all,🛑 广告拦截
  - RULE-SET,Advertising,🛑 广告拦截
  - GEOSITE,private,🌎 全球直连
  - GEOIP,private,🌎 全球直连,no-resolve
  - RULE-SET,GameDownloadCN,🌎 全球直连
  - RULE-SET,SteamCN,🌎 全球直连
  - RULE-SET,Openai,🤖 ChatGPT
  - RULE-SET,Claude,🤖 ChatGPT
  - RULE-SET,Copilot,🤖 ChatGPT
  - RULE-SET,Gemini,🤖 ChatGPT
  - RULE-SET,GoogleFCM,📢 谷歌FCM
  - RULE-SET,Youtube,🎬 油管视频
  - RULE-SET,Google,📢 谷歌服务
  - RULE-SET,Apple,🍎 苹果服务
  - RULE-SET,Microsoft,Ⓜ️ 微软服务
  - RULE-SET,Telegram,📲 电报信息
  - RULE-SET,Epic,🎮 游戏平台
  - RULE-SET,Steam,🎮 游戏平台
  - RULE-SET,ProxyGFWlist,🎯 总模式
  - GEOSITE,gfw,🎯 总模式
  - RULE-SET,ChinaCompanyIp,🌎 全球直连
  - RULE-SET,ChinaMedia,🌎 全球直连
  - GEOSITE,CN,🌎 全球直连
  - GEOIP,CN,🌎 全球直连,no-resolve
  - MATCH,🐋 漏网之鱼
